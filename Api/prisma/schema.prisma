generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                  Int     @id @default(autoincrement())
  ra                  String  @unique
  nome                String
  senha               String
  serie               String
  curso               String  @default("matematica")
  status              String  @default("ativo")
  pontuacao           Int     @default(0)
  desafiosCompletados Int     @default(0)
  criadoEm            DateTime @default(now())
  atualizadoEm        DateTime @updatedAt

  historicoDesafios   HistoricoDesafio[]
  
  @@map("Usuario")
}

model Video {
  id        Int      @id @default(autoincrement())
  titulo    String
  materia   String
  categoria String
  url       String
  descricao String?
  duracao   Int
  criadoEm  DateTime @default(now())
  atualizadoEm DateTime @updatedAt

  @@map("videos")
}

model Desafio {
  id                Int     @id @default(autoincrement())
  titulo            String
  descricao         String?
  materia           String
  nivel             String
  pontuacao         Int     @default(20)
  duracao           Int     @default(15)
  status            String  @default("ativo")
  maxTentativas     Int     @default(1)
  dataInicio        DateTime?
  dataFim           DateTime?
  
  perguntas         PerguntaDesafio[]
  historico         HistoricoDesafio[]
  
  criadoEm          DateTime @default(now())
  atualizadoEm      DateTime @updatedAt
  
  @@map("desafios")
}

model PerguntaDesafio {
  id                Int     @id @default(autoincrement())
  pergunta          String
  alternativaA      String
  alternativaB      String
  alternativaC      String
  alternativaD      String
  correta           Int
  explicacao        String?
  ordem             Int     @default(1)
  ativo             Boolean @default(true)
  
  desafioId         Int
  desafio           Desafio @relation(fields: [desafioId], references: [id], onDelete: Cascade)
  
  criadoEm          DateTime @default(now())
  atualizadoEm      DateTime @updatedAt
  
  @@map("perguntas_desafio")
}

model HistoricoDesafio {
  id                Int     @id @default(autoincrement())
  pontuacaoGanha    Int
  acertos           Int
  totalPerguntas    Int
  porcentagemAcerto Float
  dataConclusao     DateTime @default(now())
  
  usuarioId         Int
  desafioId         Int
  usuario           Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  desafio           Desafio @relation(fields: [desafioId], references: [id], onDelete: Cascade)
  
  criadoEm          DateTime @default(now())
  
  @@map("historico_desafios")
}

// ========== MODELOS DE CURSOS SIMPLIFICADOS ========== //

model Curso {
  id        Int      @id @default(autoincrement())
  titulo    String
  descricao String?
  materia   String
  categoria String
  nivel     String
  duracao   Int
  imagem    String?
  ativo     Boolean  @default(true)
  
  modulos   Modulo[]
  
  criadoEm  DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  @@map("cursos")
}

model Modulo {
  id        Int      @id @default(autoincrement())
  titulo    String
  descricao String?
  ordem     Int      @default(1)
  ativo     Boolean  @default(true)
  
  cursoId   Int
  curso     Curso    @relation(fields: [cursoId], references: [id], onDelete: Cascade)
  aulas     Aula[]
  
  criadoEm  DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  @@map("modulos")
}

model Aula {
  id        Int      @id @default(autoincrement())
  titulo    String
  descricao String?
  conteudo  String?
  videoUrl  String?
  duracao   Int      @default(15)
  ordem     Int      @default(1)
  ativo     Boolean  @default(true)
  
  moduloId  Int
  modulo    Modulo   @relation(fields: [moduloId], references: [id], onDelete: Cascade)
  
  criadoEm  DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  @@map("aulas")
}
model MensagemChat {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  conteudo  String
  tipo      String   @default("texto") // "texto", "imagem", "video", etc
  timestamp DateTime @default(now())
  
  @@map("mensagens_chat")
}
