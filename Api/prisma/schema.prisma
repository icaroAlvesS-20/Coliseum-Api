// schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                  Int                 @id @default(autoincrement())
  ra                  String              @unique
  nome                String
  senha               String
  serie               String
  curso               String              @default("matematica")
  pontuacao           Int                 @default(0)
  desafiosCompletados Int                 @default(0)
  criadoEm            DateTime            @default(now())
  atualizadoEm        DateTime            @default(now())

  progressosCursos    ProgressoCurso[]
  progressosAulas     ProgressoAula[]

  @@map("Usuario")
}

model Video {
  id        Int      @id @default(autoincrement())
  titulo    String
  materia   String
  categoria String
  url       String
  descricao String?
  duracao   Int
  criadoEm  DateTime @default(now())

  @@map("videos")
}

model Curso {
  id          Int               @id @default(autoincrement())
  titulo      String
  descricao   String?
  materia     String
  categoria   String
  nivel       String
  duracao     Int
  imagem      String?
  ativo       Boolean           @default(true)
  criadoEm    DateTime          @default(now())
  atualizadoEm DateTime         @default(now())

  modulos     Modulo[]
  progressos  ProgressoCurso[]

  @@map("cursos")
}

model Modulo {
  id          Int      @id @default(autoincrement())
  titulo      String
  descricao   String?
  ordem       Int      @default(1)
  ativo       Boolean  @default(true)
  cursoId     Int
  criadoEm    DateTime @default(now())

  curso       Curso    @relation(fields: [cursoId], references: [id], onDelete: Cascade)
  aulas       Aula[]

  @@map("modulos")
}

model Aula {
  id          Int               @id @default(autoincrement())
  titulo      String
  descricao   String?
  conteudo    String?
  videoUrl    String?
  duracao     Int               @default(15)
  ordem       Int               @default(1)
  ativo       Boolean           @default(true)
  moduloId    Int
  criadoEm    DateTime          @default(now())

  modulo      Modulo            @relation(fields: [moduloId], references: [id], onDelete: Cascade)
  progressos  ProgressoAula[]

  @@map("aulas")
}

model ProgressoCurso {
  id          Int       @id @default(autoincrement())
  progresso   Float     @default(0)
  concluido   Boolean   @default(false)
  ultimaAula  Int?
  usuarioId   Int
  cursoId     Int
  criadoEm    DateTime  @default(now())
  atualizadoEm DateTime @default(now())

  usuario     Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  curso       Curso     @relation(fields: [cursoId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, cursoId])
  @@map("progresso_cursos")
}

model ProgressoAula {
  id              Int       @id @default(autoincrement())
  concluida       Boolean   @default(false)
  dataConclusao   DateTime?
  usuarioId       Int
  aulaId          Int
  cursoId         Int
  criadoEm        DateTime  @default(now())

  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  aula            Aula      @relation(fields: [aulaId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, aulaId])
  @@map("progresso_aulas")
}
